---
sidebar: sidebar 
permalink: trident-use/trident-fsx-examples.html 
keywords: map backends, storage classes, trident backend, ontap-nas, ontap-nas-economy, ontap-nas-flexgroups, options, storageclasses, fsx 
summary: Scopri le opzioni di configurazione backend per Amazon FSx for ONTAP.  Questa sezione fornisce esempi di configurazione del backend. 
---
= Opzioni di configurazione ed esempi di FSx per ONTAP
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Scopri le opzioni di configurazione backend per Amazon FSx for ONTAP.  Questa sezione fornisce esempi di configurazione del backend.



== Opzioni di configurazione del backend

Per le opzioni di configurazione del backend, consultare la seguente tabella:

[cols="3"]
|===
| Parametro | Descrizione | Esempio 


| `version` |  | Sempre 1 


| `storageDriverName` | Nome del driver di archiviazione | `ontap-nas`, `ontap-nas-economy` , `ontap-nas-flexgroup` , `ontap-san` , `ontap-san-economy` 


| `backendName` | Nome personalizzato o backend di archiviazione | Nome del driver + "_" + dataLIF 


| `managementLIF` | Indirizzo IP di un cluster o di un LIF di gestione SVM. È possibile specificare un nome di dominio completo (FQDN).  Può essere impostato per utilizzare indirizzi IPv6 se Trident è stato installato utilizzando il flag IPv6.  Gli indirizzi IPv6 devono essere definiti tra parentesi quadre, ad esempio [28e8:d9fb:a825:b7bf:69a8:d02f:9e7b:3555]. | "10.0.0.1", "[2001:1234:abcd::fefe]" 


| `dataLIF` | Indirizzo IP del protocollo LIF.  * Driver ONTAP NAS*: NetApp consiglia di specificare dataLIF.  Se non specificato, Trident recupera i dataLIF dall'SVM.  È possibile specificare un nome di dominio completo (FQDN) da utilizzare per le operazioni di montaggio NFS, consentendo di creare un DNS round-robin per bilanciare il carico su più dataLIF.  Può essere modificato dopo l'impostazione iniziale. Fare riferimento a .  * Driver ONTAP SAN*: Non specificare per iSCSI.  Trident utilizza ONTAP Selective LUN Map per scoprire gli iSCI LIF necessari per stabilire una sessione multi-percorso.  Se dataLIF è definito in modo esplicito, viene generato un avviso.  Può essere impostato per utilizzare indirizzi IPv6 se Trident è stato installato utilizzando il flag IPv6.  Gli indirizzi IPv6 devono essere definiti tra parentesi quadre, ad esempio [28e8:d9fb:a825:b7bf:69a8:d02f:9e7b:3555]. |  


| `autoExportPolicy` | Abilita la creazione e l'aggiornamento automatici dei criteri di esportazione [Booleano].  Utilizzando il `autoExportPolicy` E `autoExportCIDRs` opzioni, Trident può gestire automaticamente le policy di esportazione. | `false` 


| `autoExportCIDRs` | Elenco di CIDR per filtrare gli IP dei nodi di Kubernetes quando `autoExportPolicy` è abilitato.  Utilizzando il `autoExportPolicy` E `autoExportCIDRs` opzioni, Trident può gestire automaticamente le policy di esportazione. | "["0.0.0.0/0", "::/0"]" 


| `labels` | Insieme di etichette arbitrarie formattate in JSON da applicare ai volumi | "" 


| `clientCertificate` | Valore codificato in Base64 del certificato client.  Utilizzato per l'autenticazione basata su certificato | "" 


| `clientPrivateKey` | Valore codificato in Base64 della chiave privata del client.  Utilizzato per l'autenticazione basata su certificato | "" 


| `trustedCACertificate` | Valore codificato in Base64 del certificato CA attendibile. Opzionale.  Utilizzato per l'autenticazione basata su certificato. | "" 


| `username` | Nome utente per connettersi al cluster o alla SVM. Utilizzato per l'autenticazione basata sulle credenziali.  Ad esempio, vsadmin. |  


| `password` | Password per connettersi al cluster o alla SVM. Utilizzato per l'autenticazione basata sulle credenziali. |  


| `svm` | Macchina virtuale di archiviazione da utilizzare | Derivato se è specificato un managementLIF SVM. 


| `storagePrefix` | Prefisso utilizzato durante il provisioning di nuovi volumi nell'SVM.  Non può essere modificato dopo la creazione.  Per aggiornare questo parametro, sarà necessario creare un nuovo backend. | `trident` 


| `limitAggregateUsage` | *Non specificare per Amazon FSx for NetApp ONTAP.*  Il fornito `fsxadmin` E `vsadmin` non contengono le autorizzazioni richieste per recuperare l'utilizzo aggregato e limitarlo tramite Trident. | Non utilizzare. 


| `limitVolumeSize` | Il provisioning non riesce se la dimensione del volume richiesto è superiore a questo valore. Limita inoltre la dimensione massima dei volumi che gestisce per qtree e LUN e `qtreesPerFlexvol` l'opzione consente di personalizzare il numero massimo di qtree per FlexVol volume | "" (non applicato di default) 


| `lunsPerFlexvol` | Il numero massimo di LUN per Flexvol deve essere compreso nell'intervallo [50, 200].  Solo SAN. | `100` 


| `debugTraceFlags` | Flag di debug da utilizzare durante la risoluzione dei problemi.  Esempio, {"api":false, "method":true} Non utilizzare `debugTraceFlags` a meno che non si stia risolvendo un problema e si necessiti di un dump di registro dettagliato. | null 


| `nfsMountOptions` | Elenco separato da virgole delle opzioni di montaggio NFS.  Le opzioni di montaggio per i volumi persistenti di Kubernetes sono normalmente specificate nelle classi di archiviazione, ma se non vengono specificate opzioni di montaggio in una classe di archiviazione, Trident utilizzerà le opzioni di montaggio specificate nel file di configurazione del backend di archiviazione.  Se non vengono specificate opzioni di montaggio nella classe di archiviazione o nel file di configurazione, Trident non imposterà alcuna opzione di montaggio su un volume persistente associato. | "" 


| `nasType` | Configurare la creazione di volumi NFS o SMB.  Le opzioni sono `nfs` , `smb` , o nullo.  *Deve essere impostato su `smb` per volumi SMB.*  Impostando il valore su null, i volumi NFS vengono impostati di default. | `nfs` 


| `qtreesPerFlexvol` | Il numero massimo di Qtree per FlexVol deve essere compreso nell'intervallo [50, 300] | `200` 


| `smbShare` | È possibile specificare uno dei seguenti elementi: il nome di una condivisione SMB creata tramite Microsoft Management Console o ONTAP CLI oppure un nome che consenta a Trident di creare la condivisione SMB.  Questo parametro è obbligatorio per i backend Amazon FSx for ONTAP . | `smb-share` 


| `useREST` | Parametro booleano per utilizzare le API REST ONTAP .  `useREST`Quando impostato su `true` , Trident utilizza le API REST ONTAP per comunicare con il backend; quando impostato su `false` Trident utilizza chiamate ONTAPI (ZAPI) per comunicare con il backend. Questa funzionalità richiede ONTAP 9.11.1 e versioni successive.  Inoltre, il ruolo di accesso ONTAP utilizzato deve avere accesso a `ontapi` applicazione.  Ciò è soddisfatto dal predefinito `vsadmin` E `cluster-admin` ruoli.  A partire dalla versione Trident 24.06 e ONTAP 9.15.1 o successiva, `useREST` è impostato su `true` per impostazione predefinita; modifica `useREST` A `false` per utilizzare le chiamate ONTAPI (ZAPI). | `true`per ONTAP 9.15.1 o successivo, altrimenti `false` . 


| `aws` | È possibile specificare quanto segue nel file di configurazione per AWS FSx per ONTAP: - `fsxFilesystemID` : Specificare l'ID del file system AWS FSx.  - `apiRegion` : Nome della regione API AWS.  - `apikey` : Chiave API AWS.  - `secretKey` : Chiave segreta AWS. | ``
`` 
`""`
`""`
`""` 


| `credentials` | Specificare le credenziali FSx SVM da archiviare in AWS Secrets Manager.  - `name` : Amazon Resource Name (ARN) del segreto, che contiene le credenziali di SVM.  - `type` : Impostato su `awsarn` .  Fare riferimento alink:https://docs.aws.amazon.com/secretsmanager/latest/userguide/create_secret.html["Crea un segreto AWS Secrets Manager"^] per maggiori informazioni. |  
|===


=== Aggiornamento `dataLIF` dopo la configurazione iniziale

È possibile modificare il dataLIF dopo la configurazione iniziale eseguendo il comando seguente per fornire il nuovo file JSON backend con il dataLIF aggiornato.

[source, console]
----
tridentctl update backend <backend-name> -f <path-to-backend-json-file-with-updated-dataLIF>
----

NOTE: Se i PVC sono collegati a uno o più pod, è necessario disattivare tutti i pod corrispondenti e quindi riattivarli affinché il nuovo dataLIF abbia effetto.



== Opzioni di configurazione del backend per il provisioning dei volumi

È possibile controllare il provisioning predefinito utilizzando queste opzioni in `defaults` sezione della configurazione.  Per un esempio, vedere gli esempi di configurazione riportati di seguito.

[cols="3"]
|===
| Parametro | Descrizione | Predefinito 


| `spaceAllocation` | Assegnazione dello spazio per LUN | `true` 


| `spaceReserve` | Modalità di prenotazione dello spazio; "nessuno" (sottile) o "volume" (spesso) | `none` 


| `snapshotPolicy` | Criterio di snapshot da utilizzare | `none` 


| `qosPolicy` | Gruppo di criteri QoS da assegnare ai volumi creati.  Scegliere tra qosPolicy o adaptiveQosPolicy per ogni pool di archiviazione o backend.  Per utilizzare i gruppi di policy QoS con Trident è necessario ONTAP 9.8 o versione successiva.  È necessario utilizzare un gruppo di policy QoS non condiviso e assicurarsi che il gruppo di policy venga applicato individualmente a ciascun componente.  Un gruppo di policy QoS condiviso impone il limite massimo per la produttività totale di tutti i carichi di lavoro. | "" 


| `adaptiveQosPolicy` | Gruppo di policy QoS adattivo da assegnare ai volumi creati.  Scegliere tra qosPolicy o adaptiveQosPolicy per ogni pool di archiviazione o backend.  Non supportato da ontap-nas-economy. | "" 


| `snapshotReserve` | Percentuale di volume riservata agli snapshot "0" | Se `snapshotPolicy` È `none` , `else` "" 


| `splitOnClone` | Dividere un clone dal suo genitore al momento della creazione | `false` 


| `encryption` | Abilita NetApp Volume Encryption (NVE) sul nuovo volume; l'impostazione predefinita è `false` .  Per utilizzare questa opzione, NVE deve essere concesso in licenza e abilitato sul cluster.  Se NAE è abilitato sul backend, qualsiasi volume fornito in Trident sarà abilitato per NAE.  Per maggiori informazioni, fare riferimento a:link:../trident-reco/security-reco.html["Come funziona Trident con NVE e NAE"] . | `false` 


| `luksEncryption` | Abilita la crittografia LUKS. Fare riferimento alink:../trident-reco/security-reco.html#Use-Linux-Unified-Key-Setup-(LUKS)["Utilizzare Linux Unified Key Setup (LUKS)"] .  Solo SAN. | "" 


| `tieringPolicy` | Criterio di tiering da utilizzare	`none` |  


| `unixPermissions` | Modalità per nuovi volumi.  *Lasciare vuoto per i volumi SMB.* | "" 


| `securityStyle` | Stile di sicurezza per i nuovi volumi.  Supporti NFS `mixed` E `unix` stili di sicurezza.  Supporti SMB `mixed` E `ntfs` stili di sicurezza. | L'impostazione predefinita di NFS è `unix` .  L'impostazione predefinita di SMB è `ntfs` . 
|===


== Configurazioni di esempio

.Configurazione della classe di archiviazione per i volumi SMB
[%collapsible]
====
Utilizzando `nasType` , `node-stage-secret-name` , E `node-stage-secret-namespace` , è possibile specificare un volume SMB e fornire le credenziali Active Directory richieste.  I volumi SMB sono supportati utilizzando `ontap-nas` solo conducente.

[source, yaml]
----
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: nas-smb-sc
provisioner: csi.trident.netapp.io
parameters:
  backendType: "ontap-nas"
  trident.netapp.io/nasType: "smb"
  csi.storage.k8s.io/node-stage-secret-name: "smbcreds"
  csi.storage.k8s.io/node-stage-secret-namespace: "default"
----
====
.Configurazione per AWS FSx per ONTAP con Secrets Manager
[%collapsible]
====
[source, yaml]
----
apiVersion: trident.netapp.io/v1
kind: TridentBackendConfig
metadata:
  name: backend-tbc-ontap-nas
spec:
  version: 1
  storageDriverName: ontap-nas
  backendName: tbc-ontap-nas
  svm: svm-name
  aws:
    fsxFilesystemID: fs-xxxxxxxxxx
  managementLIF:
  credentials:
    name: "arn:aws:secretsmanager:us-west-2:xxxxxxxx:secret:secret-name"
    type: awsarn
----
====